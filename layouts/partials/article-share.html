{{/* layouts/partials/article-share.html - ‰ºòÂåñÁâàÊú¨ */}}
<style>
    /* ÂàÜ‰∫´Ëß¶ÂèëÊåâÈíÆ */
    .share-trigger-btn {
        padding: 0.5rem 1.25rem;
        background-color: #0053e0;
        color: white;
        border: none;
        border-radius: 1rem;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 1rem;

        display: inline-flex;
        align-items: center;
    }

    .share-trigger-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(225, 123, 123, 0.5);
    }

    .share-trigger-btn:active {
        transform: translateY(0);
    }

    /* ÂàÜ‰∫´Èù¢ÊùøË¶ÜÁõñÂ±Ç */
    .share-panel-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(8px);
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        padding: 1rem;
    }

    .share-panel-overlay.active {
        opacity: 1;
        visibility: visible;
    }

    /* ÂàÜ‰∫´Èù¢ÊùøÂÆπÂô® */
    .share-panel-container {
        background: #ffffff;
        border-radius: 24px;
        max-width: 480px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        transform: scale(0.9) translateY(20px);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .share-panel-overlay.active .share-panel-container {
        transform: scale(1) translateY(0);
    }

    /* Ëá™ÂÆö‰πâÊªöÂä®Êù° */
    .share-panel-container::-webkit-scrollbar {
        width: 6px;
    }

    .share-panel-container::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 3px;
    }

    .share-panel-container::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 3px;
    }

    .share-panel-container::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
    }

    /* ÂÖ≥Èó≠ÊåâÈíÆ */
    .share-close-btn {
        position: absolute;
        top: 1rem;
        right: 1rem;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.9);
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
        z-index: 10;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .share-close-btn:hover {
        background: #fee2e2;
        color: #dc2626;
        transform: rotate(90deg);
    }

    /* Â§¥ÈÉ®Âå∫Âüü */
    .share-header {
        text-align: center;
        padding: 3rem 2rem 2rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 24px 24px 0 0;
    }

    .share-header-icon {
        width: 64px;
        height: 64px;
        margin: 0 auto 1rem;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(10px);
    }

    .share-title {
        font-size: 1.75rem;
        font-weight: 700;
        margin: 0 0 0.5rem;
    }

    .share-subtitle {
        font-size: 0.95rem;
        opacity: 0.9;
        margin: 0;
    }

    /* ÂÜÖÂÆπÂå∫Âüü */
    .share-content {
        padding: 2rem;
    }

    /* Âå∫Âùó */
    .share-section {
        margin-bottom: 2rem;
    }

    .share-section:last-child {
        margin-bottom: 0;
    }

    /* Âå∫ÂùóÊ†áÁ≠æ */
    .section-label {
        display: flex;
        align-items: center;
        font-size: 0.875rem;
        font-weight: 600;
        color: #64748b;
        margin-bottom: 1rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .section-label svg {
        margin-right: 0.5rem;
        color: #667eea;
    }

    /* ÂàÜ‰∫´ÊåâÈíÆÁΩëÊ†º */
    .share-buttons-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 0.75rem;
    }

    /* ÂàÜ‰∫´ÊåâÈíÆ */
    .share-btn {
        display: flex;
        align-items: center;
        padding: 1rem;
        border: 2px solid #f1f5f9;
        border-radius: 12px;
        background: white;
        cursor: pointer;
        transition: all 0.2s;
        text-align: left;
    }

    .share-btn:hover {
        border-color: currentColor;
        transform: translateX(4px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .share-btn-icon {
        width: 32px;
        height: 32px;
        flex-shrink: 0;
        margin-right: 1rem;
    }

    .share-btn-text {
        flex: 1;
    }

    .share-btn-name {
        display: block;
        font-weight: 600;
        font-size: 0.95rem;
        margin-bottom: 0.125rem;
    }

    .share-btn-desc {
        display: block;
        font-size: 0.8rem;
        color: #64748b;
    }

    /* Âπ≥Âè∞È¢úËâ≤ */
    .share-btn-twitter {
        color: #1da1f2;
    }
    .share-btn-linkedin {
        color: #0a66c2;
    }
    .share-btn-weibo {
        color: #e6162d;
    }
    .share-btn-wechat {
        color: #07c160;
    }
    .share-btn-qq {
        color: #12b7f5;
    }
    .share-btn-copy {
        color: #64748b;
    }

    .share-card {
        display: flex;
        flex-direction: column;
    }

    .card-decoration {
        height: 6px;
        background: white;
    }

    .card-image-wrapper {
        position: relative;
        height: 180px;
        overflow: hidden;
        display: flex; /* Ê∑ªÂä†ËøôË°å */
    }

    .card-image {
        position: absolute;
        width: 100%;
        height: auto;
        object-fit: cover;
        display: block;
        z-index: 100;
        vertical-align: top;
        flex-shrink: 0;
    }

    .card-image-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 50%;
        background: linear-gradient(to top, rgba(0, 0, 0, 0.3), transparent);
    }

    .card-body {
        padding: 1.5rem;
        background: white;
    }

    .card-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: #1e293b;
        margin: 0 0 0.75rem;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .card-description {
        font-size: 0.875rem;
        color: #64748b;
        line-height: 1.6;
        margin: 0 0 1.25rem;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    /* ‰ΩúËÄÖ‰ø°ÊÅØ */
    .card-author {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #f1f5f9;
    }

    .author-avatar-wrapper {
        position: relative;
        margin-right: 0.75rem;
    }

    .author-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .author-avatar-ring {
        position: absolute;
        border-radius: 50%;
        border: 2px solid #667eea;
        opacity: 0;
        /*animation: ring-pulse 2s ease-in-out infinite;*/
    }

    @keyframes ring-pulse {
        0%,
        100% {
            opacity: 0;
            transform: scale(1);
        }
        50% {
            opacity: 0.5;
            transform: scale(1.1);
        }
    }

    .author-info {
        flex: 1;
    }

    .author-name {
        font-weight: 600;
        color: #1e293b;
        margin: 0 0 0.25rem;
        font-size: 0.95rem;
    }

    .author-stats {
        display: flex;
        gap: 1rem;
        font-size: 0.75rem;
        color: #64748b;
        margin: 0;
    }

    .stat-item {
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    /* Ê†áÁ≠æ */
    .card-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }

    .tag-item {
        padding: 0.375rem 0.75rem;
        background: linear-gradient(135deg, #667eea15, #764ba215);
        color: #667eea;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 500;
        border: 1px solid #667eea30;
    }

    .tag-more {
        padding: 0.375rem 0.75rem;
        background: #f1f5f9;
        color: #64748b;
        border-radius: 20px;
        font-size: 0.75rem;
    }

    /* Âàõ‰ΩúÊèê‰∫§Âõæ */
    .contribution-section {
        margin-bottom: 1rem;
        padding: 1rem;
        background: #f8fafc;
        border-radius: 12px;
    }

    .contribution-title {
        display: flex;
        align-items: center;
        font-size: 0.875rem;
        font-weight: 600;
        color: #475569;
        margin: 0 0 0.75rem;
    }

    .contribution-title svg {
        margin-right: 0.5rem;
        color: #667eea;
    }

    .contribution-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, 10px);
        gap: 3px;
        margin-bottom: 0.5rem;
    }

    .contribution-cell {
        width: 10px;
        height: 10px;
        border-radius: 2px;
        transition: all 0.2s;
        cursor: pointer;
    }

    .contribution-cell:hover {
        transform: scale(1.5);
        z-index: 10;
        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.3);
    }

    .contribution-cell.level-0 {
        background: #ebedf0;
    }
    .contribution-cell.level-1 {
        background: #c6e48b;
    }
    .contribution-cell.level-2 {
        background: #7bc96f;
    }
    .contribution-cell.level-3 {
        background: #239a3b;
    }
    .contribution-cell.level-4 {
        background: #196127;
    }

    .contribution-legend {
        display: flex;
        align-items: center;
        justify-content: flex-end;
        gap: 0.5rem;
        font-size: 0.7rem;
        color: #64748b;
    }

    .legend-cells {
        display: flex;
        gap: 3px;
    }

    /* Âç°ÁâáÂ∫ïÈÉ® */
    .card-footer {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding-top: 1rem;
        border-top: 1px solid #f1f5f9;
    }

    .footer-logo {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .footer-logo img {
        height: 28px;
        width: auto;
    }

    .footer-logo span {
        font-size: 0.875rem;
        color: #64748b;
        font-weight: 500;
    }

    #qrcodeSmall canvas {
        display: block;

        /*border-radius: 8px;*/
    }

    /* Âç°ÁâáÊìç‰ΩúÊåâÈíÆ */
    .card-actions {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.75rem;
        margin-top: 1rem;
    }

    .action-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 0.875rem 1rem;
        border-radius: 12px;
        font-weight: 600;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
    }

    .action-btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .action-btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
    }

    .action-btn-secondary {
        background: white;
        color: #667eea;
        border: 2px solid #667eea;
    }

    .action-btn-secondary:hover {
        background: #667eea;
        color: white;
    }

    /* ÁªüËÆ°Âç°Áâá */
    .stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }

    .stat-card {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        padding: 1.5rem;
        border-radius: 12px;
        text-align: center;
        border: 1px solid #e2e8f0;
    }

    .stat-value {
        font-size: 2rem;
        font-weight: 700;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 0.5rem;
    }

    .stat-label {
        font-size: 0.75rem;
        color: #64748b;
        font-weight: 500;
    }

    /* ToastÊèêÁ§∫ */
    .share-toast {
        position: fixed;
        bottom: 2rem;
        left: 50%;
        transform: translateX(-50%) translateY(100px);
        background: #1e293b;
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 12px;
        font-size: 0.875rem;
        font-weight: 500;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        z-index: 10000;
        opacity: 0;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .share-toast.show {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }

    /* ÂìçÂ∫îÂºèËÆæËÆ° */
    @media (max-width: 640px) {
        .share-panel-container {
            max-width: 100%;
            border-radius: 24px 24px 0 0;
            max-height: 95vh;
        }

        .share-header {
            padding: 2rem 1.5rem 1.5rem;
        }

        .share-title {
            font-size: 1.5rem;
        }

        .share-content {
            padding: 1.5rem;
        }

        .card-actions {
            grid-template-columns: 1fr;
        }

        .contribution-grid {
            grid-template-columns: repeat(auto-fill, 8px);
            gap: 2px;
        }

        .contribution-cell {
            width: 8px;
            height: 8px;
        }
    }

    /* Ê∑±Ëâ≤Ê®°ÂºèÊîØÊåÅ */
    @media (prefers-color-scheme: dark) {
        .share-panel-container {
            background: #1e293b;
        }

        .card-body {
            background: #0f172a;
        }

        .card-title {
            color: #f1f5f9;
        }

        .card-description {
            color: #cbd5e1;
        }

        .author-name {
            color: #f1f5f9;
        }

        .share-btn {
            background: #334155;
            border-color: #475569;
        }

        .stat-card {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border-color: #475569;
        }
    }
</style>
{{ $page := . }} {{ $site := .Site }}
<!-- ‰ΩúËÄÖÂêçÁß∞ -->
{{ $author := $site.Params.author | default "‰ΩúËÄÖ" }}
<!--Â§¥ÂÉè-->
{{ $avatar := $site.Params.avatar | default "/about/avatar.jpg" }}
<!-- ÁΩëÁ´ô logo -->
{{ $logo := $site.Params.logo | default "/images/logo.png" }}
<!-- ÁΩëÁ´ôÊ†áÈ¢ò -->
{{ $title := $page.Title }}
<!-- ÊèèËø∞‰ø°‰ø°ÊÅØ -->
{{ $description := "" }} {{ if $page.Description }} {{ $description =
$page.Description }} {{ else if $page.Params.summary }} {{ $description =
$page.Params.summary }} {{ else if $page.Summary }} {{ $description =
$page.Summary | plainify | truncate 120 }} {{ else if $site.Params.description
}} {{ $description = $site.Params.description }} {{ else }} {{ $description =
"ÁΩëÁ´ôÊèèËø∞" }} {{ end }}
<!-- ÂΩìÂâçÈ°µÈìæÊé• -->
{{ $url := $page.Permalink | absURL }}
<!-- Êó•Êúü -->
{{ $date := $page.Date.Format "2006-01-02" }}
<!-- ÊúÄÂêé‰øÆÊîπÊó•Êúü -->
{{ $lastmod := $page.Lastmod.Format "2006-01-02" }}
<!---->
{{ $readingTime := $page.ReadingTime }}
<!-- Â≠óÁ¨¶Êï∞Èáè -->
{{ $wordCount := $page.WordCount }}
<!-- Ê†áÁ≠æ -->
{{ $tags := $page.Params.tags }}
<!-- ÊÄªÊñáÁ´†Êï∞Èáè -->
{{ $totalPosts := len (where $site.RegularPages "Section" "posts") }}
<!--Â∞ÅÈù¢ÂõæÁâá-->
{{ $cover := "" }}
<!--Â∞ÅÈù¢ -->
{{ if $page.Params.cover }}
<!---->
{{ $cover = $page.Params.cover }} {{ else if $page.Params.images }} {{ $cover =
index $page.Params.images 0 }} {{ end }}
<!-- ÂàÜÁ±ª -->
{{ $categories := $page.Params.categories | default slice }}
<!-- -->
{{ $postsByDate := dict }} {{ range where $site.RegularPages "Section" "posts"
}}
<!---->
{{ $postDate := .Date.Format "2006-01-02" }}
<!---->
{{ $postsByDate = merge $postsByDate (dict $postDate (add (index $postsByDate
$postDate | default 0) 1)) }} {{ end }}

<!-- ÂàÜ‰∫´ÊåâÈíÆ -->
<button class="share-trigger-btn" aria-label="ÂàÜ‰∫´ÊñáÁ´†">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"
        />
    </svg>
    <span class="ml-2">ÂàÜ‰∫´</span>
</button>

<!-- ÂàÜ‰∫´Èù¢Êùø -->
<div class="share-panel-overlay" id="sharePanel">
    <div class="share-panel-container">
        <!-- ÂÖ≥Èó≠ÊåâÈíÆ -->
        <button class="share-close-btn" aria-label="ÂÖ≥Èó≠">
            <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
            >
                <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"
                />
            </svg>
        </button>

        <div class="share-content">
            <!-- Âø´ÈÄüÂàÜ‰∫´ÊåâÈíÆ -->
            <section class="share-section">
                <h3 class="section-label">
                    <svg
                        class="w-4 h-4"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M13 10V3L4 14h7v7l9-11h-7z"
                        />
                    </svg>
                    Âø´ÈÄüÂàÜ‰∫´
                </h3>

                <div class="grid grid-cols-3 gap-3 md:gap-4">
                    <!-- Á¨¨‰∏ÄË°å -->
                    <button
                        class="share-btn-icon-only"
                        onclick="shareTo('twitter')"
                        title="Twitter"
                    >
                        <img
                            src="/icon/app/x.svg"
                            alt="Twitter"
                            class="share-btn-icon"
                        />
                    </button>

                    <button
                        class="share-btn-icon-only"
                        onclick="shareTo('linkedin')"
                        title="LinkedIn"
                    >
                        <img
                            src="/icon/app/linkedin.svg"
                            alt="LinkedIn"
                            class="share-btn-icon"
                        />
                    </button>

                    <button
                        class="share-btn-icon-only"
                        onclick="shareTo('weibo')"
                        title="ÂæÆÂçö"
                    >
                        <img
                            src="/icon/app/weibo.svg"
                            alt="ÂæÆÂçö"
                            class="share-btn-icon"
                        />
                    </button>

                    <!-- Á¨¨‰∫åË°å -->
                    <button
                        class="share-btn-icon-only"
                        onclick="shareTo('wechat')"
                        title="ÂæÆ‰ø°"
                    >
                        <img
                            src="/icon/app/weixin.svg"
                            alt="ÂæÆ‰ø°"
                            class="share-btn-icon"
                        />
                    </button>

                    <button
                        class="share-btn-icon-only"
                        onclick="shareTo('qq')"
                        title="QQ"
                    >
                        <img
                            src="/icon/app/qq.svg"
                            alt="QQ"
                            class="share-btn-icon"
                        />
                    </button>

                    <button
                        class="share-btn-icon-only"
                        onclick="copyLink()"
                        title="Â§çÂà∂ÈìæÊé•"
                    >
                        <img
                            src="/icon/app/url.svg"
                            alt="URL"
                            class="share-btn-icon"
                        />
                    </button>
                </div>
            </section>

            <!-- ÂàÜ‰∫´Âç°ÁâáÈ¢ÑËßà -->
            <section class="share-sectio">
                <h3 class="section-label">
                    <svg
                        class="w-4 h-4"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"
                        />
                    </svg>
                    ÂàÜ‰∫´Âç°Áâá
                </h3>
                <!-- Âç°ÁâáÊ∏≤Êüì -->
                <div class="share-card border-2 rounded-lg" id="shareCard">
                    <!-- ÊñáÁ´†Â§¥Âõæ -->
                    {{ if $cover }}
                    <div
                        class="w-full h-48 md:h-64 lg:h-72 overflow-hidden bg-gray-100 flex items-center justify-center"
                    >
                        <img
                            src="{{ $cover | absURL }}"
                            alt="{{ $title }}"
                            class="w-full h-full object-contain"
                            loading="lazy"
                        />
                    </div>
                    {{ end }}

                    <!-- ÊñáÁ´†‰ø°ÊÅØ -->
                    <div class="card-body">
                        <h4 class="card-title">{{ $title }}</h4>
                        <p class="card-description">{{ $description }}</p>

                        <!-- ‰ΩúËÄÖ‰ø°ÊÅØ -->
                        <div class="card-author">
                            {{ if $avatar }}
                            <div class="author-avatar-wrapper">
                                <img
                                    src="{{ $avatar | absURL }}"
                                    alt="{{ $author }}"
                                    class="author-avatar"
                                    loading="lazy"
                                />
                                <div class="author-avatar-ring"></div>
                            </div>
                            {{ end }}
                            <div class="author-info">
                                <p class="author-name">{{ $author }}</p>
                                <!-- ÁªüËÆ°‰ø°ÊÅØ -->
                                <p class="author-stats">
                                    <span class="stat-item">
                                        <svg
                                            class="w-3 h-3"
                                            fill="currentColor"
                                            viewBox="0 0 20 20"
                                        >
                                            <path
                                                d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"
                                            />
                                            <path
                                                fill-rule="evenodd"
                                                d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z"
                                                clip-rule="evenodd"
                                            />
                                        </svg>
                                        {{ $totalPosts }} ÁØá
                                    </span>
                                    <span class="stat-item">
                                        <svg
                                            class="w-3 h-3"
                                            fill="currentColor"
                                            viewBox="0 0 20 20"
                                        >
                                            <path
                                                fill-rule="evenodd"
                                                d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z"
                                                clip-rule="evenodd"
                                            />
                                        </svg>
                                        {{ $readingTime }} ÂàÜÈíü
                                    </span>
                                </p>
                            </div>
                        </div>

                        <!-- Ê†áÁ≠æ -->
                        {{ if $tags }}
                        <div class="card-tags">
                            {{ range first 3 $tags }}
                            <span class="tag-item">{{ . }}</span>
                            {{ end }} {{ if gt (len $tags) 3 }}
                            <span class="tag-more"
                                >+{{ sub (len $tags) 3 }}</span
                            >
                            {{ end }}
                        </div>
                        {{ end }}

                        <!-- Âàõ‰ΩúÊèê‰∫§Âõæ -->
                        {{ if $postsByDate }}
                        <div class="contribution-section">
                            <h5 class="contribution-title">
                                <svg
                                    class="w-4 h-4"
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                                    />
                                </svg>
                                Âàõ‰ΩúÊ¥ªË∑ÉÂ∫¶
                            </h5>
                            <div class="contribution-grid">
                                {{ $today := now.Format "2006-01-02" }}
                                <!---->
                                {{ $startDate := now.AddDate 0 -3 0 }} {{
                                $startDateStr := $startDate.Format "2006-01-02"
                                }} {{ $days := dict }}
                                <!---->
                                {{ $maxPosts := 0 }} {{ range $date, $count :=
                                $postsByDate }}
                                <!---->
                                {{ if ge $date $startDateStr }} {{ $days = merge
                                $days (dict $date $count) }} {{ if gt $count
                                $maxPosts }} {{ $maxPosts = $count }} {{ end }}
                                {{ end }} {{ end }}
                                <!---->
                                {{ $totalDays := 90 }} {{ range $daysAgo := seq
                                (sub 0 $totalDays) 0 }} {{ $date := now.AddDate
                                0 0 $daysAgo }} {{ $dateStr := $date.Format
                                "2006-01-02" }}
                                <!---->
                                {{ $count := index $days $dateStr | default 0 }}
                                <!---->
                                {{ $intensity := 0 }} {{ if gt $maxPosts 0 }} {{
                                $intensity = div (mul $count 4) $maxPosts |
                                math.Floor | int }} {{ end }} {{ $colorClass :=
                                "level-0" }}
                                <!---->
                                {{ if eq $intensity 1 }}{{ $colorClass =
                                "level-1" }}{{ end }}
                                <!---->
                                {{ if eq $intensity 2 }}{{ $colorClass =
                                "level-2" }}{{ end }}
                                <!---->
                                {{ if eq $intensity 3 }}{{ $colorClass =
                                "level-3" }}{{ end }}
                                <!---->
                                {{ if eq $intensity 4 }}
                                <!---->
                                {{ $colorClass = "level-4" }}
                                <!---->
                                {{ end }}
                                <div
                                    class="contribution-cell {{ $colorClass }}"
                                    data-date="{{ $dateStr }}"
                                    data-count="{{ $count }}"
                                    title="{{ $dateStr }}: {{ $count }} ÁØá"
                                ></div>
                                {{ end }}
                            </div>
                            <!-- Êèê‰∫§ÁÉ≠ÂõæËØ¥Êòé -->
                            <div class="contribution-legend">
                                <span>Â∞ë</span>
                                <div class="legend-cells">
                                    <div
                                        class="contribution-cell level-0"
                                    ></div>
                                    <div
                                        class="contribution-cell level-1"
                                    ></div>
                                    <div
                                        class="contribution-cell level-2"
                                    ></div>
                                    <div
                                        class="contribution-cell level-3"
                                    ></div>
                                    <div
                                        class="contribution-cell level-4"
                                    ></div>
                                </div>
                                <span>Â§ö</span>
                            </div>
                        </div>
                        {{ end }}

                        <!-- Â∫ïÈÉ®LogoÂíåÈìæÊé• -->
                        <div class="card-footer">
                            {{ if $logo }}
                            <div class="footer-logo">
                                <img
                                    src="{{ $logo | absURL }}"
                                    alt="{{ $site.Title }}"
                                    class="max-h-8 object-contain"
                                    loading="lazy"
                                />
                                <span>{{ $site.Title }}</span>
                            </div>
                            {{ end }}
                            <div class="p-1">
                                <div class="footer-qr" id="qrcodeSmall" />
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!--‰∏ãËΩΩÂç°Áâá-->
            <section>
                <div class="card-actions">
                    <button
                        onclick="generateShareImage()"
                        class="action-btn action-btn-primary"
                    >
                        <svg
                            class="w-5 h-5"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
                            />
                        </svg>
                        ‰∏ãËΩΩÂàÜ‰∫´ÂõæÁâá
                    </button>
                    <button
                        onclick="downloadQRCode()"
                        class="action-btn action-btn-secondary"
                    >
                        <svg
                            class="w-5 h-5"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"
                            />
                        </svg>
                        ‰øùÂ≠ò‰∫åÁª¥Á†Å
                    </button>
                </div>
            </section>
        </div>
    </div>
</div>

<!-- ÂºïÂÖ•ÂøÖË¶ÅÁöÑÂ∫ì -->
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.2.2/build/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<!--<script src="https://unpkg.com/qrcode@1.5.3/build/qrcode.min.js"></script>-->
<script>
    // È°µÈù¢Êï∞ÊçÆ
    const shareData = {
        title: "{{ $title | safeJS }}",
        description: "{{ $description | safeJS }}",
        url: "{{ $url | safeJS }}",
        author: "{{ $author | safeJS }}",
        siteTitle: "{{ $site.Title | safeJS }}",
    };

    // ÊâìÂºÄ/ÂÖ≥Èó≠ÂàÜ‰∫´Èù¢Êùø
    const shareTrigger = document.querySelector(".share-trigger-btn");
    const sharePanel = document.getElementById("sharePanel");
    const closeBtn = document.querySelector(".share-close-btn");

    shareTrigger?.addEventListener("click", () => {
        sharePanel.classList.add("active");
        document.body.style.overflow = "hidden";
    });

    closeBtn?.addEventListener("click", closeSharePanel);
    sharePanel?.addEventListener("click", (e) => {
        if (e.target === sharePanel) closeSharePanel();
    });

    function closeSharePanel() {
        sharePanel.classList.remove("active");
        document.body.style.overflow = "";
    }

    // ESCÈîÆÂÖ≥Èó≠
    document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && sharePanel.classList.contains("active")) {
            closeSharePanel();
        }
    });

    // ÁîüÊàê‰∫åÁª¥Á†Å
    function generateQRCode() {
        const qrElement = document.getElementById("qrcodeSmall");
        if (!qrElement) return;

        // Ê∏ÖÁ©∫ÂÆπÂô®
        qrElement.innerHTML = "";

        // ÂàõÂª∫‰∏Ä‰∏™ canvas ÂÖÉÁ¥†
        const canvas = document.createElement("canvas");
        qrElement.appendChild(canvas);

        // ‰ΩøÁî® QRCode.toCanvas
        QRCode.toCanvas(
            canvas,
            shareData.url,
            {
                width: 80,
                height: 80,
                margin: 0,
                color: {
                    dark: "#1e40af",
                    light: "#ffffff",
                },
            },
            function (error) {
                if (error) {
                    console.error("QRCodeÁîüÊàêÂ§±Ë¥•:", error);
                    // Â§áÁî®ÊñπÊ°à
                    generateQRCodeFallback();
                }
            },
        );
    }

    // Â§áÁî®ÊñπÊ°àÔºö‰ΩøÁî® new QRCode()
    function generateQRCodeFallback() {
        const qrElement = document.getElementById("qrcodeSmall");
        if (!qrElement) return;

        qrElement.innerHTML = "";

        try {
            new QRCode(qrElement, {
                text: shareData.url,
                width: 80,
                height: 80,
                colorDark: "#1e40af",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H,
            });
        } catch (e) {
            console.error("Â§áÁî®‰∫åÁª¥Á†ÅÁîüÊàê‰πüÂ§±Ë¥•:", e);
        }
    }

    // Ë∞ÉÁî®ÂáΩÊï∞
    document.addEventListener("DOMContentLoaded", function () {
        generateQRCode();
    });

    // ‰∏ãËΩΩ‰∫åÁª¥Á†Å
    function downloadQRCode() {
        const canvas = document.createElement("canvas");
        QRCode.toCanvas(
            canvas,
            shareData.url,
            {
                width: 512,
                height: 512,
                margin: 2,
                color: {
                    dark: "#1e40af",
                    light: "#ffffff",
                },
            },
            (error) => {
                if (!error) {
                    const link = document.createElement("a");
                    link.download = `qrcode-${shareData.title.replace(/\s+/g, "-")}.png`;
                    link.href = canvas.toDataURL("image/png");
                    link.click();
                    showToast("‚úì ‰∫åÁª¥Á†ÅÂ∑≤‰∏ãËΩΩ");
                }
            },
        );
    }

    // ÂàÜ‰∫´ÂäüËÉΩ
    function shareTo(platform) {
        const shareUrl = encodeURIComponent(shareData.url);
        const shareTitle = encodeURIComponent(shareData.title);
        const shareDesc = encodeURIComponent(shareData.description);
        let shareLink = "";

        switch (platform) {
            case "wechat":
                showToast("üì± ËØ∑‰ΩøÁî®ÂæÆ‰ø°Êâ´Êèè‰∫åÁª¥Á†ÅÂàÜ‰∫´");
                return;
            case "qq":
                shareLink = `https://connect.qq.com/widget/shareqq/index.html?url=${shareUrl}&title=${shareTitle}&summary=${shareDesc}`;
                break;
            case "weibo":
                shareLink = `http://service.weibo.com/share/share.php?url=${shareUrl}&title=${shareTitle}`;
                break;
            case "twitter":
                shareLink = `https://twitter.com/intent/tweet?url=${shareUrl}&text=${shareTitle}`;
                break;
            case "linkedin":
                shareLink = `https://www.linkedin.com/shareArticle?mini=true&url=${shareUrl}&title=${shareTitle}&summary=${shareDesc}`;
                break;
        }

        if (shareLink) {
            window.open(shareLink, "_blank", "width=600,height=400");
            updateShareCount();
        }
    }

    // Â§çÂà∂ÈìæÊé•
    function copyLink() {
        navigator.clipboard
            .writeText(shareData.url)
            .then(() => showToast("‚úì ÈìæÊé•Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø"))
            .catch(() => showToast("‚úó Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂"));
        updateShareCount();
    }

    // ÁîüÊàêÂàÜ‰∫´ÂõæÁâá
    function generateShareImage() {
        const shareCard = document.getElementById("shareCard");
        if (!shareCard) return;

        showToast("üé® Ê≠£Âú®ÁîüÊàêÂàÜ‰∫´ÂõæÁâá...");

        html2canvas(shareCard, {
            backgroundColor: "#ffffff",
            scale: 2,
            useCORS: true,
            allowTaint: true,
            logging: false,
        })
            .then((canvas) => {
                const link = document.createElement("a");
                link.download = `share-${shareData.title.replace(/\s+/g, "-")}.png`;
                link.href = canvas.toDataURL("image/png");
                link.click();
                showToast("‚úì ÂàÜ‰∫´ÂõæÁâáÂ∑≤ÁîüÊàê");
                updateShareCount();
            })
            .catch(() => {
                showToast("‚úó ÁîüÊàêÂ§±Ë¥•ÔºåËØ∑ÈáçËØï");
            });
    }

    // Êõ¥Êñ∞ÂàÜ‰∫´ÁªüËÆ°
    function updateShareCount() {
        const today = new Date().toDateString();
        let shareStats = JSON.parse(localStorage.getItem("shareStats") || "{}");
        let pageStats = shareStats[window.location.pathname] || {
            total: 0,
            lastDate: "",
            today: 0,
        };

        pageStats.total += 1;
        pageStats.today =
            pageStats.lastDate === today ? pageStats.today + 1 : 1;
        pageStats.lastDate = today;

        shareStats[window.location.pathname] = pageStats;
        localStorage.setItem("shareStats", JSON.stringify(shareStats));

        document.getElementById("share-count").textContent = pageStats.total;
        document.getElementById("today-share").textContent = pageStats.today;
    }

    // ÂàùÂßãÂåñÂàÜ‰∫´ÁªüËÆ°
    function initShareStats() {
        const shareStats = JSON.parse(
            localStorage.getItem("shareStats") || "{}",
        );
        const pageStats = shareStats[window.location.pathname] || {
            total: 0,
            today: 0,
        };

        document.getElementById("share-count").textContent = pageStats.total;
        document.getElementById("today-share").textContent = pageStats.today;
    }

    // ToastÊèêÁ§∫
    function showToast(message) {
        const existingToast = document.querySelector(".share-toast");
        if (existingToast) existingToast.remove();

        const toast = document.createElement("div");
        toast.className = "share-toast";
        toast.textContent = message;
        document.body.appendChild(toast);

        setTimeout(() => toast.classList.add("show"), 10);
        setTimeout(() => {
            toast.classList.remove("show");
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }

    // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
    document.addEventListener("DOMContentLoaded", () => {
        generateQRCode();
        initShareStats();
    });
</script>
