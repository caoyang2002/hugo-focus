<header class="mx-auto flex h-12 px-8 lg:justify-center">
    <!-- 左侧：品牌 + 主题切换 -->
    <div
        class="relative z-50 ltr:mr-auto rtl:ml-auto flex items-center max-w-[--w]"
    >
        {{ partial "header/brand" . }} {{ partial "header/theme-toggle" . }}
    </div>

    <!-- 移动端菜单按钮 -->
    {{ partial "header/mobile-toggle" . }}

    <!-- 主导航 -->
    {{ partial "header/navigation" . }}
</header>

<script>
    // 基础初始化
    const htmlClass = document.documentElement.classList;
    setTimeout(() => htmlClass.remove("not-ready"), 10);

    // 移动菜单功能
    const btnMenu = document.querySelector(".btn-menu");
    if (btnMenu) {
        btnMenu.addEventListener("click", () => {
            htmlClass.toggle("open");
            htmlClass.toggle("close");
        });
    }

    // 主题管理
    const themeManager = {
        metaTheme: document.querySelector('meta[name="theme-color"]'),
        lightBg: "{{ $.Scratch.Get "bg_color" }}".replace(/"/g, ""),
        btnDark: document.querySelector(".btn-dark"),

        init() {
            const darkScheme = window.matchMedia("(prefers-color-scheme: dark)");
            const isDark = localStorage.getItem("dark") === "true" ||
                          (localStorage.getItem("dark") === null && darkScheme.matches);
            this.setTheme(isDark);

            darkScheme.addEventListener("change", (e) => this.setTheme(e.matches));
            if (this.btnDark) {
                this.btnDark.addEventListener("click", () => this.toggleTheme());
            }
        },

        setTheme(isDark) {
            this.metaTheme?.setAttribute("content", isDark ? "#000" : this.lightBg);
            htmlClass[isDark ? "add" : "remove"]("dark");
            localStorage.setItem("dark", isDark);
        },

        toggleTheme() {
            this.setTheme(localStorage.getItem("dark") !== "true");
        }
    };

    themeManager.init();
</script>

<!-- 样式 -->
<style>
    header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 50;
        width: 100vw;
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        background: rgba(255, 255, 255, 0.5);
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
    }

    .header-menu:hover {
        color: #0042da;
    }
</style>
