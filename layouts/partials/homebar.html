<aside class="sticky w-64">

      <!-- 个人信息容器 -->
    <div class="not-prose rounded-lg bg-white dark:bg-neutral-800 p-3 shadow-sm">
        <!-- 个人信息卡片 -->
        <div>
            {{ with $.Scratch.Get "avatar_url" }}
                <div class="mb-4 flex justify-center">
                    <a href="{{ site.BaseURL }}" class="block relative group">
                        <img
                        src="{{ . }}"
                        class="h-24 w-24 rounded-full border-2 border-neutral-200 dark:border-neutral-700 transition-transform duration-200 group-hover:scale-105"
                        alt="avatar"
                        />
                        <div class="absolute inset-0 rounded-full bg-black opacity-0 transition-opacity duration-200 group-hover:opacity-10"></div>
                    </a>
                </div>
            {{ end }}

            {{ with site.Params.name }}
                <h2 class="mb-2 text-center text-lg font-bold bg-gradient-to-r from-neutral-800 to-neutral-600 dark:from-neutral-200 dark:to-neutral-400 bg-clip-text text-transparent">
                {{ . }}
                </h2>
            {{ end }}

            {{ with site.Params.bio }}
                <p class="mb-6 text-center text-sm text-neutral-600 dark:text-neutral-400 leading-relaxed">
                {{ . }}
                </p>
            {{ end }}

            <!-- 社交列表 -->
            {{ with $.Scratch.Get "social_list" }}
                <div
                    class="space-x-4 flex justify-center dark:invert  lg:mt-0 lg:items-center"
                >
                    {{ range . }}<!---->
                        <a
                            class="h-7 w-7 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
                            style="--url: url(./{{ . }}.svg)"
                            href="{{ if eq . `rss` }}{{ `index.xml` | absURL }}{{ else if eq . `mastodon` }}{{ index site.Params . }}{{ else }}{{ if eq . `threads` }}https://threads.net/{{ else if eq . `bluesky` }}https://bsky.app/profile/{{ else }}https://{{ . }}.com/{{ end }}{{ if eq . `linkedin` }}in/{{ end }}{{ index site.Params . }}{{ end }}"
                            target="_blank"
                            rel="{{ if eq . `rss` }}alternate{{ else }}me{{ end }}"
                        >
                            {{ . }}
                        </a>
                    {{ end }}<!---->
                </div>
            {{ end }}
        </div>

        <!-- 博客统计 -->
        <div class="py-1 text-sm text-neutral-600 dark:text-neutral-400 leading-relaxed">
            <div class="blog-analyze">
                <h3>统计</h3>
                <div class="">
                    <p>  文章总数：{{ len (where .Site.RegularPages "Section" "posts") }}</p>
                    <p>总字数：{{ $wordCount := 0 }}{{ range .Site.RegularPages }}{{ $wordCount = add $wordCount .WordCount }}{{ end }}{{ $wordCount }}</p>
                    <p>分类数：{{ len .Site.Taxonomies.categories }}</p>
                    <p> 标签数：{{ len .Site.Taxonomies.tags }}</p>
                </div>
            </div>
        </div>

        <!-- 热门文章 -->
        <div class="py-1">
            <h3>热门文章</h3>
            {{ range first 5 (where .Site.RegularPages.ByDate.Reverse "Section" "posts") }}
                <p><a href="{{ .RelPermalink }}">{{ .Title }}</a></p>
            {{ end }}
        </div>

        <!-- 标签云 -->
        <div class="py-1">
            <h3>标签云</h3>
            {{ range $name, $taxonomy := .Site.Taxonomies.tags }}
            {{ $count := .Count }}
            <a href="{{ "/tags/" | relLangURL }}{{ $name | urlize }}"
            style="font-size: {{ add 0.8 (mul 0.1 (len $taxonomy)) }}rem">
                {{ $name }} ({{ $count }})
            </a>
            {{ end }}
        </div>

        <!-- 最新内容 -->
        <!-- <div class="dynamic-content"
                data-api="{{ .Site.Params.apiEndpoint }}"
                data-refresh="60">
            {{ range first 5 .Site.RegularPages }}
                <article class="dynamic-item">
                    <h3>{{ .Title }}</h3>
                    <time>{{ .Date.Format "2006-01-02" }}</time>
                </article>
            {{ end }}
        </div> -->

        <!-- 归档 -->
        <div class="py-1">
            <h3>归档</h3>
            {{ range .Site.RegularPages.GroupByDate "2006" }}
                <!-- 年份折叠 -->
                <details class="archive-year mb-3">
                    <summary class="cursor-pointer hover:text-primary-500 font-medium">
                        {{ .Key }} ({{ len .Pages }} 篇)
                    </summary>

                    {{ range .Pages.GroupByDate "January" }}
                        <!-- 月份折叠 -->
                        <details class="archive-month ml-4 mb-2">
                            <summary class="cursor-pointer hover:text-primary-500">
                                {{ .Key }} ({{ len .Pages }} 篇)
                            </summary>

                            <div class="ml-4">
                                {{ range .Pages }}
                                    <article style="font-size: 12px;" class="flex items-center gap-2 py-1">
                                        <time class="text-sm text-neutral-500">{{ .Date.Format "02" }}</time>
                                        <a href="{{ .RelPermalink }}" class="hover:text-primary-500 ">{{ .Title }}</a>
                                        <span class="text-sm text-neutral-500">{{ .ReadingTime }} 分钟阅读</span>
                                    </article>
                                {{ end }}
                            </div>
                        </details>
                    {{ end }}
                </details>
            {{ end }}
        </div>
    </div>
</aside>

<style>
/* 固定目录样式 */
aside {
  position: fixed;  /* 改为固定定位 */
  top: 8rem;          /* 距离顶部 8rem */
   bottom: 8rem;       /* 距离底部 2rem */
   right: 0rem;
   width: 14rem;
   height: auto;       /* 高度自适应 */
   overflow-y: auto;
   z-index: 10;
}

/* 自定义折叠箭头样式 */
details > summary {
    list-style: none;
    padding: 0.5rem 0;
}

details > summary::before {
    content: "▶";
    display: inline-block;
    margin-right: 0.5rem;
    transition: transform 0.2s;
}

details[open] > summary::before {
    transform: rotate(90deg);
}

/* 动画效果 */
details[open] > div {
    animation: slideDown 0.3s ease-out;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

</style>

<script>
// 目录滚动监听
document.addEventListener('DOMContentLoaded', () => {
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      const id = entry.target.getAttribute('id');
      const tocLink = document.querySelector(`.toc a[href="#${id}"]`);

      if (entry.intersectionRatio > 0) {
        document.querySelectorAll('.toc a.active').forEach(node => {
          node.classList.remove('active');
        });
        tocLink?.classList.add('active');
      }
    });
  }, {
    rootMargin: '-20% 0px -80% 0px'
  });

  // 观察所有标题元素
  document.querySelectorAll('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]').forEach(heading => {
    observer.observe(heading);
  });
});

  // 移动端目录切换
  let touchStartX = 0;
  let touchEndX = 0;

  document.addEventListener('touchstart', e => {
    touchStartX = e.changedTouches[0].screenX;
  }, false);

  document.addEventListener('touchend', e => {
    touchEndX = e.changedTouches[0].screenX;
    handleSwipe();
  }, false);

  function handleSwipe() {
    const aside = document.querySelector('aside');
    const swipeLength = touchEndX - touchStartX;

    if (Math.abs(swipeLength) > 50) {
      if (swipeLength < 0) {
        aside?.classList.add('show');
      } else {
        aside?.classList.remove('show');
      }
    }
  }
</script>
